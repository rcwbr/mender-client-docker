# Launch the Mender client Docker image locally for testing
services:
  mender-client-setup:
    image: mender-client-docker
    container_name: mender-client-setup
    environment:
      DEVICE_TYPE: virtual
      TENANT_TOKEN: ${TENANT_TOKEN}
    networks:
      default:
        mac_address: ${MAC_ADDRESS}
    entrypoint: /setup-entrypoint
    volumes:
      # Saves the client configuration between container restarts
      - mender-client-config:/etc/mender
  mender-client:
    image: mender-client-docker
    container_name: mender-client
    networks:
      default:
        mac_address: ${MAC_ADDRESS}
    volumes:
      # Mount the setup from the mender-client-config container
      - mender-client-config:/etc/mender
      # Saves the client key between container restarts
      - mender-client-data:/var/lib/mender
      - /var/run/docker.sock:/var/run/docker.sock
    restart: always
    depends_on:
      mender-client-setup:
        condition: service_completed_successfully

volumes:
  mender-client-config:
  mender-client-data:
